<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Deep Visualization Toolbox</title>
    {% load static %}

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
          media="screen,projection">
    <link type="text/css" rel="stylesheet" href='{% static "style.css" %}' media="screen,projection">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>


</head>
<body>
<!-- Setting Section -->
<script>console.log({{ layer_info }})</script>
<div class="row">
    <ul id="slide-out" class="sidenav col s2">
        <li><a href="#!"><i class="material-icons">ac_unit</i>Freeze camera image</a></li>
        <li><a href="#!"><i class="material-icons">camera</i>Camera image</a></li>
        <li><a href="#!"><i class="material-icons">crop</i>Crop Image</a></li>
        <li><a href="#!"><i class="material-icons">image</i>Preferred Input</a></li>
        <li>
            <div class="divider"></div>
        </li>
        <li class="switch">
            <label>
                forward
                <input type="checkbox">
                <span class="lever"></span>
                backward
            </label>
        </li>
    </ul>
</div>
<a href="#" data-target="slide-out" class="sidenav-trigger" style="position: absolute;right: 10px">
    <i class="material-icons" style="color: #616161">settings</i>
</a>
<!-- # -->
<div class="row">
    <div class="col s3  ">
        <div class="center-align" id="input_frame">
            <canvas id="input_canvas" class="responsive-canvas">asda</canvas>
        </div>
        <div>
            <ul class="collapsible expandable">
                <li>
                    <div class="collapsible-header"><i class="material-icons">label</i>Label predictions</div>
                    <div class="collapsible-body">
                        <span class="green-text text-darken-4">0.55 tiger shark</span>
                        <br>
                        <span class="green-text text-darken-4">0.44 great white shark</span>
                        <br>
                        <span>0.01 hammerhead</span>
                        <br>
                        <span>0.00 dugong</span>
                    </div>
                </li>
                <li>
                    <div class="collapsible-header"><i class="material-icons">filter_none</i>Selected channel</div>
                    <div class="collapsible-body">
                        <span>
                            <img class="responsive-img"
                                 src="../statics/img/Screenshot%20from%202020-02-28%2015-19-27.png">
                        </span>
                    </div>
                </li>
                <li>
                    <div class="collapsible-header"><i class="material-icons">arrow_back_io</i>Bprob/deconv selected
                        channel
                    </div>
                    <div class="collapsible-body">
                        <span>
                            <img class="responsive-img"
                                 src="../statics/img/Screenshot%20from%202020-02-28%2015-19-47.png">
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col s6">
        <ul class="tabs">
            {% for tab in layer_info %}
                {% if forloop.counter == 1 %}
                    <li class="tab"><a class="active" href="#{{ tab }}">{{ tab }}</a></li>
                {% else %}
                    <li class="tab"><a href="#{{ tab }}">{{ tab }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>
        {% for tab in layer_info %}
            <div id="{{ tab }}" class="col s12">
                {{ tab }}
            </div>
        {% endfor %}
    </div>
    <div class="col s3">
        <div class="center-align">
            <h5>Gradient ascent</h5>
            <img src="../statics/img/Screenshot%20from%202020-02-28%2015-20-15.png" class="responsive-img">
        </div>
        <div class="center-align">
            <h5>Top 9 image</h5>
            <img src="../statics/img/Screenshot%20from%202020-02-28%2015-20-26.png" class="responsive-img">
        </div>
        <div class="center-align">
            <h5>Deconv of top 9</h5>
            <img src="../statics/img/Screenshot%20from%202020-02-28%2015-20-36.png" class="responsive-img">
        </div>
    </div>
</div>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let collapsible_elems = document.querySelectorAll('.collapsible');
        let collapsible_options = {accordion: false};
        let collapsible_instances = M.Collapsible.init(collapsible_elems, collapsible_options);
        let sidenav_elems = document.querySelectorAll('.sidenav');
        let sidenav_option = {};
        let sidenav_instances = M.Sidenav.init(sidenav_elems, sidenav_option);
        let tabs_elems = document.querySelectorAll('.tabs');
        let tabs_options = {}
        let tabs_instances = M.Tabs.init(tabs_elems, tabs_options)
    });
    let update_input_frame = $.ajax({url: "{% url "caffevis_API:update_input_frame" %}", method: "GET"});
    update_input_frame.done(result => {
        let shape = result.shape;
        let data = result.image_data;
        console.log(result);
        {#let input_frame = $("#input_frame");#}
        let input_canvas = document.getElementById("input_canvas");
        input_canvas.width = shape[1];
        input_canvas.height = shape[0];
        let ctx = input_canvas.getContext("2d");
        let imageData = ctx.createImageData(shape[0], shape[1]);
        console.log(data)
        for (let i = 0; i < shape[1]; i++) {
            for (let j = 0; j < shape[0]; j++) {
                let index = (j + i * shape[1]) * 4;
                imageData.data[index + 0] = data[i][j][0];
                imageData.data[index + 1] = data[i][j][1];
                imageData.data[index + 2] = data[i][j][2];
                imageData.data[index + 3] = 255;
            }
        }
        console.log(ctx)
        console.log(imageData)
        console.log(input_canvas)
        ctx.putImageData(imageData, 0, 0);

    })
</script>
</body>
</html>